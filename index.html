<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DM to Make File â€” @arfg.editz</title>
<style>
body{font-family:sans-serif;padding:20px;background:#0a0f1a;color:white;text-align:center;}
.container{max-width:600px;margin:auto;}
h1{margin-top:0;}
.lead{color:#cbd5e1;}
#files{margin-top:20px;text-align:left;}
.file-item{margin:10px 0;}
input, button{padding:10px;margin:5px;border-radius:6px;font-size:16px;}
input[type=file]{color:white;}
button{background:#38bdf8;border:none;color:#000;font-weight:bold;cursor:pointer;}
#status{margin-top:15px;color:#94a3b8;}
#ownerPrompt{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#0a0f1a;z-index:9999;color:white;display:flex;flex-direction:column;justify-content:center;align-items:center;}
#ownerPrompt button{margin-top:10px;}
</style>
</head>
<body>

<div id="ownerPrompt">
  <h2>Are you the Owner or a Visitor?</h2>
  <button id="ownerBtn">I'm Owner</button>
  <button id="visitorBtn">I'm Visitor</button>
</div>

<div class="container" id="mainContent" style="display:none;">
<h1>Want a file made?</h1>
<p class="lead">DM me on Discord with your screenshots or photos, and I'll upload them here.</p>
<p>Discord: <b>@arfg.editz</b> | ID: <b>1323331952559919235</b></p>

<!-- Admin upload section -->
<div id="admin" style="margin-top:20px; display:none;">
<input type="file" id="fileInput"><br>
<button id="uploadBtn">Upload File</button>
<div id="status"></div>
</div>

<h2>Uploaded Files</h2>
<div id="files"></div>
</div>

<script>
// CONFIG
const owner = "lesgofrfr"; // GitHub username
const repo = "Upload"; // Repo name
const token = "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"; // <-- INSERT YOUR TOKEN HERE
const secretKey = "123beerYeekzylesgofrfr!?56"; // <-- INSERT YOUR OWNER PASSWORD HERE

const status = document.getElementById("status");
const filesDiv = document.getElementById("files");
const uploadBtn = document.getElementById("uploadBtn");
const adminDiv = document.getElementById("admin");
const mainContent = document.getElementById("mainContent");
const ownerPrompt = document.getElementById("ownerPrompt");

// OWNER CHECK
let role = localStorage.getItem("role"); // "owner" or "visitor"
if(!role){
  ownerPrompt.style.display = "flex";
}

document.getElementById("ownerBtn").onclick = () => {
  let password = prompt("Enter secret password to verify owner:");
  if(password === secretKey){
    localStorage.setItem("role","owner");
    role = "owner";
    ownerPrompt.style.display = "none";
    initPage();
  } else {
    alert("Incorrect password. Logging as visitor.");
    localStorage.setItem("role","visitor");
    role = "visitor";
    ownerPrompt.style.display = "none";
    initPage();
  }
}

document.getElementById("visitorBtn").onclick = () => {
  localStorage.setItem("role","visitor");
  role = "visitor";
  ownerPrompt.style.display = "none";
  initPage();
}

// INITIALIZE PAGE
function initPage(){
  mainContent.style.display = "block";
  if(role === "owner"){
    adminDiv.style.display = "block";
  }
  loadFiles();
}

// LOAD FILES FROM GITHUB
async function loadFiles(){
  filesDiv.innerHTML = "Loading files...";
  try{
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/`);
    const data = await res.json();
    filesDiv.innerHTML = "";
    data.forEach(item => {
      if(item.type === "file" && !["index.html","styles.css","upload.html"].includes(item.name)){
        const a = document.createElement("a");
        a.href = item.download_url;
        a.textContent = item.name;
        a.target = "_blank"; // each file opens in its own page/tab
        const div = document.createElement("div");
        div.className = "file-item";
        div.appendChild(a);
        filesDiv.appendChild(div);
      }
    });
  } catch(e){
    filesDiv.innerHTML = "Error loading files.";
  }
}

// UPLOAD FILE (OWNER ONLY)
uploadBtn.onclick = async () => {
  if(role !== "owner") return;

  const fileInput = document.getElementById("fileInput");
  if(fileInput.files.length === 0){
    status.textContent = "Select a file first!";
    return;
  }

  const file = fileInput.files[0];
  const arrayBuffer = await file.arrayBuffer();
  const base64 = btoa(
    new Uint8Array(arrayBuffer).reduce((data, byte) => data + String.fromCharCode(byte), '')
  );
  const path = file.name;

  try{
    const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`,{
      method:"PUT",
      headers:{
        Authorization:`token ${token}`,
        "Content-Type":"application/json"
      },
      body: JSON.stringify({
        message: `Upload ${file.name}`,
        content: base64
      })
    });

    if(res.ok){
      status.textContent = "File uploaded successfully!";
      fileInput.value = "";
      loadFiles(); // refresh list
    } else {
      const err = await res.json();
      status.textContent = "Upload failed: " + (err.message || res.statusText);
    }
  } catch(e){
    status.textContent = "Error: " + e.message;
  }
};
</script>

</body>
</html>